name: SDASH-DEV

on:
  push:
   branches: [sdash-python-net-reverse-branch]
  
env:  
  AZURE_WEBAPP_NAME: 'dev-sdash'
  AZURE_FUNCTIONAPP_NAME: 'func-sdash-dev-001'
  AZURE_WEBAPP_PACKAGE_PATH: '.'
  DOTNET_VERSION: '6.0.x' 
  
jobs:    
  dev:      
    runs-on: windows-latest           
    steps:     
    - uses: actions/checkout@v2
    - uses: azure/login@v1
      with:
          creds: ${{ secrets.DEV_AZURE_CREDENTIALS }}     
   
    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
          dotnet-version: ${{ env.DOTNET_VERSION }}    

    - name: dotnet build and publish
      run: |
          dotnet restore
          dotnet build --configuration Release
          dotnet publish -c Release              
     
    - name: Deploy to SDASH Azure Web App
      id: deploy-to-webapp
      uses: azure/webapps-deploy@v2
      with:
         app-name: ${{ env.AZURE_WEBAPP_NAME }}
         package: ./ABSPlatform/bin/Release/net6.0/publish
         
    - name: 'Deploy to SDASH Functions'
      id: deploy-sdash-fa
      uses: Azure/functions-action@v1      
      with:
        app-name: ${{ env.AZURE_FUNCTIONAPP_NAME }}
        package: './ABSPlatform.Functions/bin/Release/net6.0/publish'
        
    - name: logout
      run: |
          az logout
